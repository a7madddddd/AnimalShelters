

<section class="title-banner mb-80">
  <div class="container-fluid-2">
    <div class="title-wrapper">
      <div class="row align-items-center">
        <div class="col-lg-6 col-sm-6">
          <div class="title-content">
            <h1 class="medium-black fw-600">Our Community</h1>
          </div>
        </div>
        <div class="col-lg-6 col-sm-6 d-sm-block d-none">
          <div class="title-image text-end">
            <img src="assets/media/backgrounds/banner-image.png" alt="">
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="container mt-4">
  <div class="row">
    <div *ngFor="let post of approvedPosts" class="col-lg-4 col-md-6 col-sm-12 mb-4">
      <div class="card">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ post.title }}</h5>
          <h6 class="card-subtitle mb-2 text-muted">{{ post.userName }}</h6>
          <img *ngIf="post.image" [src]="'https://localhost:44354/api/Community/getImage/' + post.image" class="img-fluid mb-3" alt="Post Image" style="max-height: 150px; object-fit: cover;">
          <p class="card-text flex-grow-1" style="overflow-y: auto;">{{ post.content }}</p>

          <div class="d-flex justify-content-between">
            <small class="text-muted">Tag: {{ post.tag }}</small>
            <small class="text-muted">Likes: {{ post.likesCount }}</small>
          </div>

          <div class="mt-3 d-flex justify-content-start">
            <button class="btn btn-sm me-2" (click)="toggleLike(post)">
              <i class="bi bi-hand-thumbs-up"></i> Like
            </button>
            <button class="btn btn-sm me-2" (click)="post.showComments = !post.showComments">
              <i class="bi bi-chat"></i> Comment ({{ post.comments.length }})
            </button>
            <button class="btn btn-sm" (click)="openShareModal(post)">
              <i class="bi bi-share"></i> Share
            </button>
          </div>

          <div *ngIf="post.showComments" class="mt-4">
            <h6>Comments</h6>
            <ul class="list-group" style="max-height: 150px; overflow-y: auto;">
              <li *ngFor="let comment of post.comments" class="list-group-item">
                <p>{{ comment.content }}</p>
                <div class="mt-2 d-flex justify-content-start">
                  <button class="btn btn-sm me-2">
                    <i class="bi bi-hand-thumbs-up"></i> Like
                  </button>
                  <button class="btn btn-sm" (click)="comment.showReply = !comment.showReply">
                    <i class="bi" [ngClass]="comment.showReply ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
                    {{ comment.showReply ? 'Hide Replies' : 'Show Replies' }}
                  </button>
                </div>

                <div *ngIf="comment.showReply" class="ms-3 mt-3">
                  <h6>Replies</h6>
                  <ul class="list-group" style="max-height: 50px; overflow-y: auto;">
                    <li *ngFor="let reply of comment.replies" class="list-group-item">
                      {{ reply.content }}
                    </li>
                  </ul>

                  <!-- Add new reply section -->
                  <div class="mt-2">
                    <textarea [(ngModel)]="newReply[comment.id]" class="form-control" placeholder="Add a reply"></textarea>
                    <button class="btn btn-primary btn-sm mt-2" (click)="addReply(comment)">
                      Add Reply
                    </button>
                    <div *ngIf="comment.errorMessage" class="alert alert-danger mt-2">
                      {{ comment.errorMessage }}
                    </div>
                  </div>
                </div>
              </li>
            </ul>

            <!-- Add new comment section -->
            <div class="mt-3">
              <textarea [(ngModel)]="newComment" class="form-control" placeholder="Add a comment"></textarea>
              <button class="btn btn-primary btn-sm mt-2" (click)="addComment(post)">
                Add Comment
              </button>
              <div *ngIf="post.errorMessage" class="alert alert-danger mt-2">
                {{ post.errorMessage }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal for sharing options -->
<div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="shareModalLabel">Share Post</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Share this post on:</p>
        <button class="btn btn-outline-success" (click)="shareOnWhatsApp(selectedPost)">WhatsApp</button>
        <button class="btn btn-outline-primary" (click)="shareOnFacebook(selectedPost)">Facebook</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal for sharing options -->
<div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="shareModalLabel">Share Post</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Share this post on:</p>
        <button class="btn btn-outline-success" (click)="shareOnWhatsApp(selectedPost)">WhatsApp</button>
        <button class="btn btn-outline-primary" (click)="shareOnFacebook(selectedPost)">Facebook</button>
      </div>
    </div>
  </div>
</div>
